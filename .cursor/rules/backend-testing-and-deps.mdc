---
description: Правила для зависимостей и тестов бэкенда (dari-al-backend), чтобы избежать прошлых ошибок ассистента
globs: dari-al-backend/**
alwaysApply: false
---

# Правила для зависимостей и интеграционных тестов

## 1. Testcontainers и Docker

- **Не добавлять Testcontainers или другие Docker-зависимые решения по умолчанию.**
- **Если нужны интеграционные тесты с БД**, сначала предлагать вариант:
  - использовать уже существующий Postgres (например, из `docker-compose.yml` или локальный инстанс),
  - либо упростить тест до unit-теста без внешних сервисов.
- **Testcontainers добавлять только по явному запросу пользователя** и явно проговаривать, что для их работы нужен запущенный Docker.

## 2. Версии Jackson

- При добавлении или изменении зависимостей `com.fasterxml.jackson.*` **обязательно выравнивать версии**:
  - `jackson-annotations`,
  - `jackson-core`,
  - `jackson-databind`
  должны быть **одной версии**.
- Для этого проекта, если не сказано иное пользователем, использовать **версию `2.19.1`** для всех `jackson-*` артефактов.
- **Критично**: Если используются Testcontainers или другие зависимости, которые транзитивно тянут старую `jackson-annotations` (например, `docker-java-api` тянет `2.10.3`):
  - Добавить `exclusion` у **всех** таких зависимостей (не только у `testcontainers`, но и у `testcontainers:postgresql`, `testcontainers:junit-jupiter` и т.д.).
  - Использовать `<dependencyManagement>` для форсирования версии `jackson-annotations:2.19.1`.
  - Явно добавить зависимость `jackson-annotations:2.19.1` в `<dependencies>`.

## 3. Правки pom.xml

- При любых изменениях `pom.xml`:
  - внимательно проверять `groupId` и `artifactId` на опечатки,
  - по возможности минимизировать количество новых зависимостей, особенно инфраструктурных (логирование, контейнеры, плагины).
- После правок `pom.xml` **всегда запускать `mvn -q -DskipTests=false test`** и фиксить ошибки сборки до продолжения работы.

